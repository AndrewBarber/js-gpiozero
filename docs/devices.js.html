<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>devices.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Buzzer.html">Buzzer</a><ul class='methods'><li data-type='method'><a href="Buzzer.html#active_high">active_high</a></li><li data-type='method'><a href="Buzzer.html#beep">beep</a></li><li data-type='method'><a href="Buzzer.html#blink">blink</a></li><li data-type='method'><a href="Buzzer.html#close">close</a></li><li data-type='method'><a href="Buzzer.html#closed">closed</a></li><li data-type='method'><a href="Buzzer.html#is_active">is_active</a></li><li data-type='method'><a href="Buzzer.html#off">off</a></li><li data-type='method'><a href="Buzzer.html#on">on</a></li><li data-type='method'><a href="Buzzer.html#pin">pin</a></li><li data-type='method'><a href="Buzzer.html#toggle">toggle</a></li><li data-type='method'><a href="Buzzer.html#toString">toString</a></li><li data-type='method'><a href="Buzzer.html#value">value</a></li></ul></li><li><a href="CompositeDevice.html">CompositeDevice</a><ul class='methods'><li data-type='method'><a href="CompositeDevice.html#close">close</a></li><li data-type='method'><a href="CompositeDevice.html#is_active">is_active</a></li><li data-type='method'><a href="CompositeDevice.html#length">length</a></li><li data-type='method'><a href="CompositeDevice.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="CompositeDevice.html#value">value</a></li></ul></li><li><a href="CompositeOutputDevice.html">CompositeOutputDevice</a><ul class='methods'><li data-type='method'><a href="CompositeOutputDevice.html#close">close</a></li><li data-type='method'><a href="CompositeOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="CompositeOutputDevice.html#length">length</a></li><li data-type='method'><a href="CompositeOutputDevice.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="CompositeOutputDevice.html#off">off</a></li><li data-type='method'><a href="CompositeOutputDevice.html#on">on</a></li><li data-type='method'><a href="CompositeOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="CompositeOutputDevice.html#value">value</a></li></ul></li><li><a href="Device.html">Device</a><ul class='methods'><li data-type='method'><a href="Device.html#close">close</a></li><li data-type='method'><a href="Device.html#is_active">is_active</a></li><li data-type='method'><a href="Device.html#value">value</a></li></ul></li><li><a href="DigitalOutputDevice.html">DigitalOutputDevice</a><ul class='methods'><li data-type='method'><a href="DigitalOutputDevice.html#active_high">active_high</a></li><li data-type='method'><a href="DigitalOutputDevice.html#blink">blink</a></li><li data-type='method'><a href="DigitalOutputDevice.html#close">close</a></li><li data-type='method'><a href="DigitalOutputDevice.html#closed">closed</a></li><li data-type='method'><a href="DigitalOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="DigitalOutputDevice.html#off">off</a></li><li data-type='method'><a href="DigitalOutputDevice.html#on">on</a></li><li data-type='method'><a href="DigitalOutputDevice.html#pin">pin</a></li><li data-type='method'><a href="DigitalOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="DigitalOutputDevice.html#toString">toString</a></li><li data-type='method'><a href="DigitalOutputDevice.html#value">value</a></li></ul></li><li><a href="GPIODevice.html">GPIODevice</a><ul class='methods'><li data-type='method'><a href="GPIODevice.html#close">close</a></li><li data-type='method'><a href="GPIODevice.html#closed">closed</a></li><li data-type='method'><a href="GPIODevice.html#is_active">is_active</a></li><li data-type='method'><a href="GPIODevice.html#pin">pin</a></li><li data-type='method'><a href="GPIODevice.html#toString">toString</a></li><li data-type='method'><a href="GPIODevice.html#value">value</a></li></ul></li><li><a href="LED.html">LED</a><ul class='methods'><li data-type='method'><a href="LED.html#active_high">active_high</a></li><li data-type='method'><a href="LED.html#blink">blink</a></li><li data-type='method'><a href="LED.html#close">close</a></li><li data-type='method'><a href="LED.html#closed">closed</a></li><li data-type='method'><a href="LED.html#is_active">is_active</a></li><li data-type='method'><a href="LED.html#is_lit">is_lit</a></li><li data-type='method'><a href="LED.html#off">off</a></li><li data-type='method'><a href="LED.html#on">on</a></li><li data-type='method'><a href="LED.html#pin">pin</a></li><li data-type='method'><a href="LED.html#toggle">toggle</a></li><li data-type='method'><a href="LED.html#toString">toString</a></li><li data-type='method'><a href="LED.html#value">value</a></li></ul></li><li><a href="LEDBoard.html">LEDBoard</a><ul class='methods'><li data-type='method'><a href="LEDBoard.html#active_high">active_high</a></li><li data-type='method'><a href="LEDBoard.html#close">close</a></li><li data-type='method'><a href="LEDBoard.html#is_active">is_active</a></li><li data-type='method'><a href="LEDBoard.html#leds">leds</a></li><li data-type='method'><a href="LEDBoard.html#length">length</a></li><li data-type='method'><a href="LEDBoard.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="LEDBoard.html#off">off</a></li><li data-type='method'><a href="LEDBoard.html#on">on</a></li><li data-type='method'><a href="LEDBoard.html#toggle">toggle</a></li><li data-type='method'><a href="LEDBoard.html#value">value</a></li></ul></li><li><a href="LEDCollection.html">LEDCollection</a><ul class='methods'><li data-type='method'><a href="LEDCollection.html#active_high">active_high</a></li><li data-type='method'><a href="LEDCollection.html#close">close</a></li><li data-type='method'><a href="LEDCollection.html#is_active">is_active</a></li><li data-type='method'><a href="LEDCollection.html#leds">leds</a></li><li data-type='method'><a href="LEDCollection.html#length">length</a></li><li data-type='method'><a href="LEDCollection.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="LEDCollection.html#off">off</a></li><li data-type='method'><a href="LEDCollection.html#on">on</a></li><li data-type='method'><a href="LEDCollection.html#toggle">toggle</a></li><li data-type='method'><a href="LEDCollection.html#value">value</a></li></ul></li><li><a href="Motor.html">Motor</a><ul class='methods'><li data-type='method'><a href="Motor.html#backward">backward</a></li><li data-type='method'><a href="Motor.html#close">close</a></li><li data-type='method'><a href="Motor.html#closed">closed</a></li><li data-type='method'><a href="Motor.html#forward">forward</a></li><li data-type='method'><a href="Motor.html#is_active">is_active</a></li><li data-type='method'><a href="Motor.html#length">length</a></li><li data-type='method'><a href="Motor.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="Motor.html#reverse">reverse</a></li><li data-type='method'><a href="Motor.html#stop">stop</a></li><li data-type='method'><a href="Motor.html#value">value</a></li></ul></li><li><a href="OutputDevice.html">OutputDevice</a><ul class='methods'><li data-type='method'><a href="OutputDevice.html#active_high">active_high</a></li><li data-type='method'><a href="OutputDevice.html#close">close</a></li><li data-type='method'><a href="OutputDevice.html#closed">closed</a></li><li data-type='method'><a href="OutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="OutputDevice.html#off">off</a></li><li data-type='method'><a href="OutputDevice.html#on">on</a></li><li data-type='method'><a href="OutputDevice.html#pin">pin</a></li><li data-type='method'><a href="OutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="OutputDevice.html#toString">toString</a></li><li data-type='method'><a href="OutputDevice.html#value">value</a></li></ul></li><li><a href="PiTraffic.html">PiTraffic</a></li><li><a href="PWMLED.html">PWMLED</a><ul class='methods'><li data-type='method'><a href="PWMLED.html#blink">blink</a></li><li data-type='method'><a href="PWMLED.html#close">close</a></li><li data-type='method'><a href="PWMLED.html#frequency">frequency</a></li><li data-type='method'><a href="PWMLED.html#is_active">is_active</a></li><li data-type='method'><a href="PWMLED.html#is_lit">is_lit</a></li><li data-type='method'><a href="PWMLED.html#off">off</a></li><li data-type='method'><a href="PWMLED.html#on">on</a></li><li data-type='method'><a href="PWMLED.html#pulse">pulse</a></li><li data-type='method'><a href="PWMLED.html#toggle">toggle</a></li><li data-type='method'><a href="PWMLED.html#value">value</a></li></ul></li><li><a href="PWMOutputDevice.html">PWMOutputDevice</a><ul class='methods'><li data-type='method'><a href="PWMOutputDevice.html#blink">blink</a></li><li data-type='method'><a href="PWMOutputDevice.html#close">close</a></li><li data-type='method'><a href="PWMOutputDevice.html#frequency">frequency</a></li><li data-type='method'><a href="PWMOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="PWMOutputDevice.html#off">off</a></li><li data-type='method'><a href="PWMOutputDevice.html#on">on</a></li><li data-type='method'><a href="PWMOutputDevice.html#pulse">pulse</a></li><li data-type='method'><a href="PWMOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="PWMOutputDevice.html#value">value</a></li></ul></li><li><a href="RGBLED.html">RGBLED</a><ul class='methods'><li data-type='method'><a href="RGBLED.html#close">close</a></li><li data-type='method'><a href="RGBLED.html#is_active">is_active</a></li><li data-type='method'><a href="RGBLED.html#off">off</a></li><li data-type='method'><a href="RGBLED.html#on">on</a></li><li data-type='method'><a href="RGBLED.html#toggle">toggle</a></li><li data-type='method'><a href="RGBLED.html#value">value</a></li></ul></li><li><a href="TrafficLights.html">TrafficLights</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">devices.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const ReadWriteLock = require('rwlock');
const exc = require('./exc.js');
const wiringpi = require('./pins/wiringpi.js').WiringPiPin;
const inherit = require('./tools.js').inherit;

const _PINS = new Set();
const _PINS_LOCK = new ReadWriteLock(); //Yes, this needs to be re-entrant

/*    /*if(name == undefined) {
        name=process.env.GPIOZERO_PIN_FACTORY;
    }    
    var group = 'gpiozero_pin_factories'
    if (name == undefined) {
        /*# If no factory is explicitly specified, try various names in
        # "preferred" order. Note that in this case we only select from
        # gpiozero distribution so without explicitly specifying a name (via
        # the environment) it's impossible to auto-select a factory from
        # outside the base distribution
        #
        # We prefer RPi.GPIO here as it supports PWM, and all Pi revisions.  If
        # no third-party libraries are available, however, we fall back to a
        # pure Python implementation which supports platforms like PyPy
        dist = pkg_resources.get_distribution('gpiozero')
        for name in ('RPiGPIOPin', 'RPIOPin', 'PiGPIOPin', 'NativePin'):
            try:
                return pkg_resources.load_entry_point(dist, group, name)
            except ImportError:
                pass
        raise BadPinFactory('Unable to locate any default pin factory!')
    } else {
        for factory in pkg_resources.iter_entry_points(group, name):
            return factory.load()
        raise BadPinFactory('Unable to locate pin factory "%s"' % name)
    }*/

//}


//var pin_factory = _default_pin_factory();

/**
 *  Represents a single device of any type; GPIO-based, SPI-based, I2C-based,
 *  etc. This is the base class of the device hierarchy. It defines the
 *  basic services applicable to all devices (specifically the {@link Device#is_active|is_active}
 *  property, the {@link Device#value|value} property, and the {@link Device#close|close} method).
 *
 * @class
 */
function Device() {
// eslint-disable-next-line no-empty-function
}
/**
 * Returns a value representing the device's state. Frequently, this is a
 * boolean value, or a number between 0 and 1 but some devices use larger
 * ranges (e.g. -1 to +1) and composite devices usually use tuples to
 * return the states of all their subordinate components.
 */
Device.prototype.value = function() {

    throw new exc.NotImplementedError();
};

/**
 *  Returns `true` if the device is currently active and `false`
 *  otherwise. This property is usually derived from `value` attribute. Unlike
 *  `value` attribute, this is *always* a boolean.
 */
Device.prototype.is_active = function() {

    return (this.value !== undefined);
};
/**
 * Internal method to check if device is available.
 *
 * @private
 */
Device.prototype._check_open = function() {
    if (this.closed()) {
        throw new exc.DeviceClosed('is closed or uninitialized');
    }
};
/**
 * @abstract
 */
Device.prototype.close = function() {
    return;
};

exports.Device = Device;

/**
 *  Represents a device composed of multiple devices like simple HATs, H-bridge motor controllers, robots composed of multiple motors, etc.
 *  The constructor accepts subordinate devices as positional or keyword arguments.
 *  Positional arguments form unnamed devices accessed via the (@link CompositeDevice#all|all) attribute,
 *  while keyword arguments are added to the device as named attributes.
 *
 * @param {Array} devices - An Array of positional devices.
 * @param {Array} kwdevices - An Array of tuples containing device name and device.
 * @class
 * @augments Device
 */
function CompositeDevice(devices, kwdevices) {
    this._all = [];
    this._namedtuple = [];
    let i;
    if(devices !== undefined) {
        for (i = 0; i &lt; devices.length; i++) {
            this[i] = devices[i];
            this._namedtuple.push('_' + i);
            this._all.push(devices[i]);
        }
    }

    if(kwdevices !== undefined) {
        for (i = 0; i &lt; kwdevices.length; i++) {
            const device_name = kwdevices[i][0];
            this[device_name] = kwdevices[i][1];
            this._namedtuple.push(kwdevices[i][0]);
            this._all.push(kwdevices[i][1]);
        }
    }
    Device.call(this);
}

CompositeDevice.prototype = inherit(Device.prototype);
CompositeDevice.prototype.constructor = CompositeDevice;

/**
 *
 * @returns {number} - The number of subordinate devices.
 */
CompositeDevice.prototype.length = function() {
    return this._all.length;
};

/**
 *
 * @returns {Array} - An array of subordinate device names.
 */
CompositeDevice.prototype.namedtuple = function() {
    return this._namedtuple;
};

/**
 *
 * @returns {Array} - An array of all subordinate device values.
 */
CompositeDevice.prototype.value = function () {
    let i;
    const result = [];
    for (i = 0; i &lt; this._all.length; i++) {
        result[i] = this._all[i].value();
    }
    return result;
};

/**
 *
 * @returns {boolean} - An array of each subordinate devices active state.
 */
CompositeDevice.prototype.is_active = function () {
    let i;
    for (i = 0; i &lt; this._all.length; i++) {
        if (this._all[i].value()) {
            return true;
        }
    }
    return false;
};

/**
 * Close all subordinate devices.
 */
CompositeDevice.prototype.close = function () {
    this._all.forEach((device) => {
        device.close();
    });
};

exports.CompositeDevice = CompositeDevice;
/*
class CompositeDevice(Device):

    :param list _order:
        If specified, this is the order of named items specified by keyword
        arguments (to ensure that the :attr:`value` tuple is constructed with a
        specific order). All keyword arguments *must* be included in the
        collection. If omitted, an alphabetically sorted order will be selected
        for keyword arguments.
    """
    def __init__(self, *args, **kwargs):
        self._all = ()
        self._named = frozendict({})
        self._namedtuple = None
        self._order = kwargs.pop('_order', None)
        if self._order is None:
            self._order = sorted(kwargs.keys())
        else:
            for missing_name in set(kwargs.keys()) - set(self._order):
                raise CompositeDeviceBadOrder('%s missing from _order' % missing_name)
        self._order = tuple(self._order)
        super(CompositeDevice, self).__init__()
        for name in set(self._order) &amp; set(dir(self)):
            raise CompositeDeviceBadName('%s is a reserved name' % name)
        self._all = args + tuple(kwargs[v] for v in self._order)
        for dev in self._all:
            if not isinstance(dev, Device):
                raise CompositeDeviceBadDevice("%s doesn't inherit from Device" % dev)
        self._named = frozendict(kwargs)
        self._namedtuple = namedtuple('%sValue' % self.__class__.__name__, chain(
            (str(i) for i in range(len(args))), self._order),
            rename=True)

    def __getattr__(self, name):
        # if _named doesn't exist yet, pretend it's an empty dict
        if name == '_named':
            return frozendict({})
        try:
            return self._named[name]
        except KeyError:
            raise AttributeError("no such attribute %s" % name)

    def __setattr__(self, name, value):
        # make named components read-only properties
        if name in self._named:
            raise AttributeError("can't set attribute %s" % name)
        return super(CompositeDevice, self).__setattr__(name, value)

    def __repr__(self):
        try:
            self._check_open()
            return "&lt;gpiozero.%s object containing %d devices: %s and %d unnamed>" % (
                    self.__class__.__name__,
                    len(self), ','.join(self._order),
                    len(self) - len(self._named)
                    )
        except DeviceClosed:
            return "&lt;gpiozero.%s object closed>" % (self.__class__.__name__)

    def __getitem__(self, index):
        return self._all[index]

    def __iter__(self):
        return iter(self._all)

    @property
    def all(self):
        # XXX Deprecate this in favour of using the instance as a container
        return self._all

    def close(self):
        if self._all:
            for device in self._all:
                device.close()

    @property
    def closed(self):
        return all(device.closed for device in self)

    @property
    def namedtuple(self):
        return self._namedtuple

    @property
    def value(self):
        return self.namedtuple(*(device.value for device in self))

    @property
    def is_active(self):
        return any(self.value)

 */

/**
 * Represents a generic GPIO device and provides the services common to all single-pin GPIO devices
 * (like ensuring two GPIO devices do no share a {@link Pin}).
 *
 * @param {(int | Pin)} pin - The GPIO pin (in BCM numbering) or a instance of {@link Pin} that the device is connected to.
 *
 * @throws {GPIOPinMissing} - If pin is 'undefined'
 * @throws {GPIOPinInUse} - If the pin is already in use by another device
 * @class
 * @augments Device
 */
function GPIODevice(pin) {
    Device.call(this);
    this._pin = undefined;
    if (pin === undefined) {
        throw new exc.GPIOPinMissing('No pin given');
    }
    if (Number.isInteger(pin)) {
        pin = new wiringpi(pin);
    }

    _PINS_LOCK.readLock((release) => {
        if (_PINS.has(pin)) {
            throw new exc.GPIOPinInUse('pin ' + pin.toString() + ' is already in use by another gpiozero object');
        }
        _PINS.add(pin);
        release();
    });

    this._pin = pin;
    this._active_state = true;
    this._inactive_state = false;
}

GPIODevice.prototype = inherit(Device.prototype);
GPIODevice.prototype.constructor = GPIODevice;

/**
 * Close the device and remove the pin allocation allowing it to be reused.
 */
GPIODevice.prototype.close = function() {
    const that = this;
    _PINS_LOCK.readLock((release) => {
        const pin = that._pin;
        if (_PINS.has(pin)) {
            _PINS.delete(pin);
            that._pin.close();
        }
        that._pin = undefined;
        release();
    });
};

/**
 *
 * @returns {boolean} - Is ``true`` is no pin is allocated.
 */
GPIODevice.prototype.closed = function() {
    return (this._pin === undefined);
};

/**
 *
 * @returns {undefined|*|int|Pin} - The {@link Pin} that the device is connected to. This will be ``undefined``
 * if the device has been closed (see the :meth:`close` method). When dealing with GPIO pins, query ``pin.number``
 * to discover the GPIO pin (in BCM numbering) that the device is connected to.
 */
GPIODevice.prototype.pin = function() {
    return this._pin;
};

/**
 * @returns {int|Boolean} - Current value of the pin.
 */
GPIODevice.prototype.value = function() {
    return this._read();
};

/**
 * Internal method to read the pin value.
 *
 * @private
 */
GPIODevice.prototype._read = function() {
    this._check_open();
    return this._state_to_value(this.pin().state());
};

/**
 * Internal method to apply active state high and convert the actual value to a logical value.
 *
 * @param {boolean|float} state - The value to be converted.
 * @returns {boolean} - The logical value of the pin.
 * @private
 */
GPIODevice.prototype._state_to_value = function(state) {
    return Boolean(state === this._active_state);
};
/**
 *
 * @returns {boolean} - Is true is the device value is currently set.
 */
GPIODevice.prototype.is_active = function() {
    return Boolean(this.value());
};

/**
 *
 * @returns {string} - Description of the device.
 */
GPIODevice.prototype.toString = function() {
    return "&lt;gpiozero.GPIODevice object on pin " + this._pin._number.toString() + ", is_active=" + this.is_active() + ">";
};

exports.GPIODevice = GPIODevice;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Dec 28 2016 22:21:04 GMT+0000 (GMT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
