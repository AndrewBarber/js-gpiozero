<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>output_devices/PWMOutputDevice.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Buzzer.html">Buzzer</a><ul class='methods'><li data-type='method'><a href="Buzzer.html#active_high">active_high</a></li><li data-type='method'><a href="Buzzer.html#beep">beep</a></li><li data-type='method'><a href="Buzzer.html#blink">blink</a></li><li data-type='method'><a href="Buzzer.html#close">close</a></li><li data-type='method'><a href="Buzzer.html#closed">closed</a></li><li data-type='method'><a href="Buzzer.html#is_active">is_active</a></li><li data-type='method'><a href="Buzzer.html#off">off</a></li><li data-type='method'><a href="Buzzer.html#on">on</a></li><li data-type='method'><a href="Buzzer.html#pin">pin</a></li><li data-type='method'><a href="Buzzer.html#toggle">toggle</a></li><li data-type='method'><a href="Buzzer.html#toString">toString</a></li><li data-type='method'><a href="Buzzer.html#value">value</a></li></ul></li><li><a href="CompositeDevice.html">CompositeDevice</a><ul class='methods'><li data-type='method'><a href="CompositeDevice.html#close">close</a></li><li data-type='method'><a href="CompositeDevice.html#is_active">is_active</a></li><li data-type='method'><a href="CompositeDevice.html#length">length</a></li><li data-type='method'><a href="CompositeDevice.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="CompositeDevice.html#value">value</a></li></ul></li><li><a href="CompositeOutputDevice.html">CompositeOutputDevice</a><ul class='methods'><li data-type='method'><a href="CompositeOutputDevice.html#close">close</a></li><li data-type='method'><a href="CompositeOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="CompositeOutputDevice.html#length">length</a></li><li data-type='method'><a href="CompositeOutputDevice.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="CompositeOutputDevice.html#off">off</a></li><li data-type='method'><a href="CompositeOutputDevice.html#on">on</a></li><li data-type='method'><a href="CompositeOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="CompositeOutputDevice.html#value">value</a></li></ul></li><li><a href="Device.html">Device</a><ul class='methods'><li data-type='method'><a href="Device.html#close">close</a></li><li data-type='method'><a href="Device.html#is_active">is_active</a></li><li data-type='method'><a href="Device.html#value">value</a></li></ul></li><li><a href="DigitalInputDevice.html">DigitalInputDevice</a><ul class='methods'><li data-type='method'><a href="DigitalInputDevice.html#close">close</a></li><li data-type='method'><a href="DigitalInputDevice.html#closed">closed</a></li><li data-type='method'><a href="DigitalInputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="DigitalInputDevice.html#pin">pin</a></li><li data-type='method'><a href="DigitalInputDevice.html#pull_up">pull_up</a></li><li data-type='method'><a href="DigitalInputDevice.html#toString">toString</a></li><li data-type='method'><a href="DigitalInputDevice.html#value">value</a></li></ul></li><li><a href="DigitalOutputDevice.html">DigitalOutputDevice</a><ul class='methods'><li data-type='method'><a href="DigitalOutputDevice.html#active_high">active_high</a></li><li data-type='method'><a href="DigitalOutputDevice.html#blink">blink</a></li><li data-type='method'><a href="DigitalOutputDevice.html#close">close</a></li><li data-type='method'><a href="DigitalOutputDevice.html#closed">closed</a></li><li data-type='method'><a href="DigitalOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="DigitalOutputDevice.html#off">off</a></li><li data-type='method'><a href="DigitalOutputDevice.html#on">on</a></li><li data-type='method'><a href="DigitalOutputDevice.html#pin">pin</a></li><li data-type='method'><a href="DigitalOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="DigitalOutputDevice.html#toString">toString</a></li><li data-type='method'><a href="DigitalOutputDevice.html#value">value</a></li></ul></li><li><a href="GPIODevice.html">GPIODevice</a><ul class='methods'><li data-type='method'><a href="GPIODevice.html#close">close</a></li><li data-type='method'><a href="GPIODevice.html#closed">closed</a></li><li data-type='method'><a href="GPIODevice.html#is_active">is_active</a></li><li data-type='method'><a href="GPIODevice.html#pin">pin</a></li><li data-type='method'><a href="GPIODevice.html#toString">toString</a></li><li data-type='method'><a href="GPIODevice.html#value">value</a></li></ul></li><li><a href="InputDevice.html">InputDevice</a><ul class='methods'><li data-type='method'><a href="InputDevice.html#close">close</a></li><li data-type='method'><a href="InputDevice.html#closed">closed</a></li><li data-type='method'><a href="InputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="InputDevice.html#pin">pin</a></li><li data-type='method'><a href="InputDevice.html#pull_up">pull_up</a></li><li data-type='method'><a href="InputDevice.html#toString">toString</a></li><li data-type='method'><a href="InputDevice.html#value">value</a></li></ul></li><li><a href="LED.html">LED</a><ul class='methods'><li data-type='method'><a href="LED.html#active_high">active_high</a></li><li data-type='method'><a href="LED.html#blink">blink</a></li><li data-type='method'><a href="LED.html#close">close</a></li><li data-type='method'><a href="LED.html#closed">closed</a></li><li data-type='method'><a href="LED.html#is_active">is_active</a></li><li data-type='method'><a href="LED.html#is_lit">is_lit</a></li><li data-type='method'><a href="LED.html#off">off</a></li><li data-type='method'><a href="LED.html#on">on</a></li><li data-type='method'><a href="LED.html#pin">pin</a></li><li data-type='method'><a href="LED.html#toggle">toggle</a></li><li data-type='method'><a href="LED.html#toString">toString</a></li><li data-type='method'><a href="LED.html#value">value</a></li></ul></li><li><a href="LEDBoard.html">LEDBoard</a><ul class='methods'><li data-type='method'><a href="LEDBoard.html#active_high">active_high</a></li><li data-type='method'><a href="LEDBoard.html#close">close</a></li><li data-type='method'><a href="LEDBoard.html#is_active">is_active</a></li><li data-type='method'><a href="LEDBoard.html#leds">leds</a></li><li data-type='method'><a href="LEDBoard.html#length">length</a></li><li data-type='method'><a href="LEDBoard.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="LEDBoard.html#off">off</a></li><li data-type='method'><a href="LEDBoard.html#on">on</a></li><li data-type='method'><a href="LEDBoard.html#toggle">toggle</a></li><li data-type='method'><a href="LEDBoard.html#value">value</a></li></ul></li><li><a href="LEDCollection.html">LEDCollection</a><ul class='methods'><li data-type='method'><a href="LEDCollection.html#active_high">active_high</a></li><li data-type='method'><a href="LEDCollection.html#close">close</a></li><li data-type='method'><a href="LEDCollection.html#is_active">is_active</a></li><li data-type='method'><a href="LEDCollection.html#leds">leds</a></li><li data-type='method'><a href="LEDCollection.html#length">length</a></li><li data-type='method'><a href="LEDCollection.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="LEDCollection.html#off">off</a></li><li data-type='method'><a href="LEDCollection.html#on">on</a></li><li data-type='method'><a href="LEDCollection.html#toggle">toggle</a></li><li data-type='method'><a href="LEDCollection.html#value">value</a></li></ul></li><li><a href="MockPin.html">MockPin</a></li><li><a href="MockPulledUpPin.html">MockPulledUpPin</a></li><li><a href="Motor.html">Motor</a><ul class='methods'><li data-type='method'><a href="Motor.html#backward">backward</a></li><li data-type='method'><a href="Motor.html#close">close</a></li><li data-type='method'><a href="Motor.html#closed">closed</a></li><li data-type='method'><a href="Motor.html#forward">forward</a></li><li data-type='method'><a href="Motor.html#is_active">is_active</a></li><li data-type='method'><a href="Motor.html#length">length</a></li><li data-type='method'><a href="Motor.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="Motor.html#reverse">reverse</a></li><li data-type='method'><a href="Motor.html#stop">stop</a></li><li data-type='method'><a href="Motor.html#value">value</a></li></ul></li><li><a href="OutputDevice.html">OutputDevice</a><ul class='methods'><li data-type='method'><a href="OutputDevice.html#active_high">active_high</a></li><li data-type='method'><a href="OutputDevice.html#close">close</a></li><li data-type='method'><a href="OutputDevice.html#closed">closed</a></li><li data-type='method'><a href="OutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="OutputDevice.html#off">off</a></li><li data-type='method'><a href="OutputDevice.html#on">on</a></li><li data-type='method'><a href="OutputDevice.html#pin">pin</a></li><li data-type='method'><a href="OutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="OutputDevice.html#toString">toString</a></li><li data-type='method'><a href="OutputDevice.html#value">value</a></li></ul></li><li><a href="Pin.html">Pin</a></li><li><a href="PiTraffic.html">PiTraffic</a></li><li><a href="PWMLED.html">PWMLED</a><ul class='methods'><li data-type='method'><a href="PWMLED.html#blink">blink</a></li><li data-type='method'><a href="PWMLED.html#close">close</a></li><li data-type='method'><a href="PWMLED.html#frequency">frequency</a></li><li data-type='method'><a href="PWMLED.html#is_active">is_active</a></li><li data-type='method'><a href="PWMLED.html#is_lit">is_lit</a></li><li data-type='method'><a href="PWMLED.html#off">off</a></li><li data-type='method'><a href="PWMLED.html#on">on</a></li><li data-type='method'><a href="PWMLED.html#pulse">pulse</a></li><li data-type='method'><a href="PWMLED.html#toggle">toggle</a></li><li data-type='method'><a href="PWMLED.html#value">value</a></li></ul></li><li><a href="PWMOutputDevice.html">PWMOutputDevice</a><ul class='methods'><li data-type='method'><a href="PWMOutputDevice.html#blink">blink</a></li><li data-type='method'><a href="PWMOutputDevice.html#close">close</a></li><li data-type='method'><a href="PWMOutputDevice.html#frequency">frequency</a></li><li data-type='method'><a href="PWMOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="PWMOutputDevice.html#off">off</a></li><li data-type='method'><a href="PWMOutputDevice.html#on">on</a></li><li data-type='method'><a href="PWMOutputDevice.html#pulse">pulse</a></li><li data-type='method'><a href="PWMOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="PWMOutputDevice.html#value">value</a></li></ul></li><li><a href="RGBLED.html">RGBLED</a><ul class='methods'><li data-type='method'><a href="RGBLED.html#close">close</a></li><li data-type='method'><a href="RGBLED.html#is_active">is_active</a></li><li data-type='method'><a href="RGBLED.html#off">off</a></li><li data-type='method'><a href="RGBLED.html#on">on</a></li><li data-type='method'><a href="RGBLED.html#toggle">toggle</a></li><li data-type='method'><a href="RGBLED.html#value">value</a></li></ul></li><li><a href="TrafficLights.html">TrafficLights</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">output_devices/PWMOutputDevice.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const inherit = require('../tools.js').inherit;
const OutputDevice = require('./OutputDevice.js').OutputDevice;
const exc = require('../exc.js');

exports.PWMOutputDevice = PWMOutputDevice;

/**
 * Generic output device configured for pulse-width modulation (PWM).
 *
 * @param {int | Pin} pin - The GPIO pin which the device is attached to.
 * @param {boolean} active_high - If ``true`` (the default), the {@link PWMOutputDevice#on|on} method will set the GPIO to HIGH.
 * If ``false``, the {@link PWMOutputDevice#on|on} method will set the GPIO to LOW (the {@link PWMOutputDevice#off|off} method always does the opposite).
 * @param {int} initial_value - If ``0`` (the default), the device's duty cycle will be 0 initially.
 * Other values between 0 and 1 can be specified as an initial duty cycle.
 * Note that ``undefined`` cannot be specified (unlike the parent class) as there is no way to tell PWM not to alter the state of the pin.
 * @param {int} frequency - The frequency (in Hz) of pulses emitted to drive the device. Defaults to 100Hz.
 * @class
 *
 * @throws OutputDeviceBadValue - When intial_value is ``undefined``.
 */
function PWMOutputDevice(pin, active_high, initial_value, frequency) {
    if (initial_value !== undefined) {
        if (initial_value &lt; 0 || initial_value > 1) {
            throw new exc.OutputDeviceBadValue("initial_value must be between 0 and 1, actual=:" + initial_value);
        }
    }

    OutputDevice.call(this, pin, active_high, initial_value);

    try {
        this._pin.frequency(frequency === undefined ? 100 : frequency);
        this.value(initial_value === undefined ? 0 : initial_value);
    } catch (e) {
        this.close();
        throw e;
    }
}

PWMOutputDevice.prototype = inherit(OutputDevice.prototype);
PWMOutputDevice.prototype.constructor = PWMOutputDevice;
/**
 * The duty cycle of the PWM device. 0.0 is off, 1.0 is fully on.
 * Values in between may be specified for varying levels of power in the device.
 *
 * @param {float} [value] - When defined then sets the device duty cycle.
 * @returns {float} - When value is undefined then the current duty cycle is returned.
 */
PWMOutputDevice.prototype.value = function(value) {
    if (value === undefined) {
        return this._read();
    }
    this._pin._stop_blink();
    this._write(value);
};
/**
 * Internal method that converts the actual pin value to it's logical value.
 *
 * @returns {number} - Logical pin value.
 * @private
 */
PWMOutputDevice.prototype._read = function() {
    this._check_open();
    if (this.active_high()) {
        return this._pin.state();
    }
    return 1 - this._pin.state();
};

/**
 * Internal method used to convert a logical value to the state the pin needs to change to.
 *
 * @param {float} value - Logical value to set the device to.
 * @private
 * @throws OutputDeviceBadValue - Occurs if the value specified is not between 0 and 1.
 */
PWMOutputDevice.prototype._write = function(value) {
    if (!this.active_high()) {
        value = 1 - value;
    }
    if (value &lt; 0 || value > 1) {
        throw new exc.OutputDeviceBadValue("PWM value must be between 0 and 1");
    }
    this._check_open();
    this._pin.state(value);
};

/**
 * Sets or Gets the device frequency.
 *
 * @param {int} [value] - The new frequency for the device.
 * @returns {int} - If value is undefined then the current device frequency is returned.
 */
PWMOutputDevice.prototype.frequency = function(value) {
    if (value === undefined) {
        return this._pin.frequency();
    }
    this._pin.frequency(value);
};

/**
 *
 * @returns {boolean} - If the device has a value other than 0 then true.
 */
PWMOutputDevice.prototype.is_active = function() {
    return this.value() !== 0;
};

/**
 * Turn the device fully on.
 */
PWMOutputDevice.prototype.on = function() {
    this._pin._stop_blink();
    this._write(1);
};

/**
 * Turn the device off.
 */
PWMOutputDevice.prototype.off = function() {
    this._pin._stop_blink();
    this._write(0);
};

/**
 * Toggle the state of the device. If the device is currently off (value` is 0.0),
 * this changes it to "fully" on (`value` is 1.0).
 * If the device has a duty cycle (`value`) of 0.1, this will toggle it to 0.9, and so on.
 */
PWMOutputDevice.prototype.toggle = function() {
    this._pin._stop_blink();
    const newValue = 1 - this.value();
    this.value(newValue);
};

/**
 * Stop any actions such as blink and unlink from pin.
 */
PWMOutputDevice.prototype.close = function() {
    this._pin._stop_blink();
    this._pin.frequency(-1);
    OutputDevice.prototype.close.call(this);
};

/**
 * Make the device turn on and off repeatedly.
 *
 * @param {float} [on_time] - Number of seconds on. Defaults to 1 second.
 * @param {float} [off_time] - Number of seconds off. Defaults to 1 second.
 * @param {float} [fade_in_time] - Number of seconds to spend fading in. Defaults to 0.
 * @param {float} [fade_out_time] - Number of seconds to spend fading out. Defaults to 0.
 * @param {int} [n] - Number of times to blink; ``undefined`` (the default) means forever.
 * @param {@callback} [callback] - Function to be called after n loops.
 */
PWMOutputDevice.prototype.blink = function(on_time, off_time, fade_in_time, fade_out_time, n, callback) {
    this._pin.blink(on_time, off_time, fade_in_time, fade_out_time, n, undefined, callback);
};

/**
 * Make the device fade in and out repeatedly.
 *
 * @param {float} [fade_in_time] - Number of seconds to spend fading in. Defaults to 0.
 * @param {float} [fade_out_time] - Number of seconds to spend fading out. Defaults to 0.
 * @param {int} [n] - Number of times to blink; ``undefined`` (the default) means forever.
 * @param {@callback} [callback] - Function to be called after n loops.
 */
PWMOutputDevice.prototype.pulse = function(fade_in_time, fade_out_time, n, callback) {
    const on_time = 0,
        off_time = 0;

    this._pin.blink(on_time, off_time, fade_in_time, fade_out_time, n, undefined, callback);
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Dec 30 2016 16:41:48 GMT+0000 (GMT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
