<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>pins/pigpio.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Buzzer.html">Buzzer</a><ul class='methods'><li data-type='method'><a href="Buzzer.html#active_high">active_high</a></li><li data-type='method'><a href="Buzzer.html#beep">beep</a></li><li data-type='method'><a href="Buzzer.html#blink">blink</a></li><li data-type='method'><a href="Buzzer.html#close">close</a></li><li data-type='method'><a href="Buzzer.html#closed">closed</a></li><li data-type='method'><a href="Buzzer.html#is_active">is_active</a></li><li data-type='method'><a href="Buzzer.html#off">off</a></li><li data-type='method'><a href="Buzzer.html#on">on</a></li><li data-type='method'><a href="Buzzer.html#pin">pin</a></li><li data-type='method'><a href="Buzzer.html#toggle">toggle</a></li><li data-type='method'><a href="Buzzer.html#toString">toString</a></li><li data-type='method'><a href="Buzzer.html#value">value</a></li></ul></li><li><a href="CompositeDevice.html">CompositeDevice</a><ul class='methods'><li data-type='method'><a href="CompositeDevice.html#close">close</a></li><li data-type='method'><a href="CompositeDevice.html#is_active">is_active</a></li><li data-type='method'><a href="CompositeDevice.html#length">length</a></li><li data-type='method'><a href="CompositeDevice.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="CompositeDevice.html#value">value</a></li></ul></li><li><a href="CompositeOutputDevice.html">CompositeOutputDevice</a><ul class='methods'><li data-type='method'><a href="CompositeOutputDevice.html#close">close</a></li><li data-type='method'><a href="CompositeOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="CompositeOutputDevice.html#length">length</a></li><li data-type='method'><a href="CompositeOutputDevice.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="CompositeOutputDevice.html#off">off</a></li><li data-type='method'><a href="CompositeOutputDevice.html#on">on</a></li><li data-type='method'><a href="CompositeOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="CompositeOutputDevice.html#value">value</a></li></ul></li><li><a href="Device.html">Device</a><ul class='methods'><li data-type='method'><a href="Device.html#close">close</a></li><li data-type='method'><a href="Device.html#is_active">is_active</a></li><li data-type='method'><a href="Device.html#value">value</a></li></ul></li><li><a href="DigitalInputDevice.html">DigitalInputDevice</a><ul class='methods'><li data-type='method'><a href="DigitalInputDevice.html#close">close</a></li><li data-type='method'><a href="DigitalInputDevice.html#closed">closed</a></li><li data-type='method'><a href="DigitalInputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="DigitalInputDevice.html#pin">pin</a></li><li data-type='method'><a href="DigitalInputDevice.html#pull_up">pull_up</a></li><li data-type='method'><a href="DigitalInputDevice.html#toString">toString</a></li><li data-type='method'><a href="DigitalInputDevice.html#value">value</a></li></ul></li><li><a href="DigitalOutputDevice.html">DigitalOutputDevice</a><ul class='methods'><li data-type='method'><a href="DigitalOutputDevice.html#active_high">active_high</a></li><li data-type='method'><a href="DigitalOutputDevice.html#blink">blink</a></li><li data-type='method'><a href="DigitalOutputDevice.html#close">close</a></li><li data-type='method'><a href="DigitalOutputDevice.html#closed">closed</a></li><li data-type='method'><a href="DigitalOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="DigitalOutputDevice.html#off">off</a></li><li data-type='method'><a href="DigitalOutputDevice.html#on">on</a></li><li data-type='method'><a href="DigitalOutputDevice.html#pin">pin</a></li><li data-type='method'><a href="DigitalOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="DigitalOutputDevice.html#toString">toString</a></li><li data-type='method'><a href="DigitalOutputDevice.html#value">value</a></li></ul></li><li><a href="GPIODevice.html">GPIODevice</a><ul class='methods'><li data-type='method'><a href="GPIODevice.html#close">close</a></li><li data-type='method'><a href="GPIODevice.html#closed">closed</a></li><li data-type='method'><a href="GPIODevice.html#is_active">is_active</a></li><li data-type='method'><a href="GPIODevice.html#pin">pin</a></li><li data-type='method'><a href="GPIODevice.html#toString">toString</a></li><li data-type='method'><a href="GPIODevice.html#value">value</a></li></ul></li><li><a href="InputDevice.html">InputDevice</a><ul class='methods'><li data-type='method'><a href="InputDevice.html#close">close</a></li><li data-type='method'><a href="InputDevice.html#closed">closed</a></li><li data-type='method'><a href="InputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="InputDevice.html#pin">pin</a></li><li data-type='method'><a href="InputDevice.html#pull_up">pull_up</a></li><li data-type='method'><a href="InputDevice.html#toString">toString</a></li><li data-type='method'><a href="InputDevice.html#value">value</a></li></ul></li><li><a href="LED.html">LED</a><ul class='methods'><li data-type='method'><a href="LED.html#active_high">active_high</a></li><li data-type='method'><a href="LED.html#blink">blink</a></li><li data-type='method'><a href="LED.html#close">close</a></li><li data-type='method'><a href="LED.html#closed">closed</a></li><li data-type='method'><a href="LED.html#is_active">is_active</a></li><li data-type='method'><a href="LED.html#is_lit">is_lit</a></li><li data-type='method'><a href="LED.html#off">off</a></li><li data-type='method'><a href="LED.html#on">on</a></li><li data-type='method'><a href="LED.html#pin">pin</a></li><li data-type='method'><a href="LED.html#toggle">toggle</a></li><li data-type='method'><a href="LED.html#toString">toString</a></li><li data-type='method'><a href="LED.html#value">value</a></li></ul></li><li><a href="LEDBoard.html">LEDBoard</a><ul class='methods'><li data-type='method'><a href="LEDBoard.html#active_high">active_high</a></li><li data-type='method'><a href="LEDBoard.html#close">close</a></li><li data-type='method'><a href="LEDBoard.html#is_active">is_active</a></li><li data-type='method'><a href="LEDBoard.html#leds">leds</a></li><li data-type='method'><a href="LEDBoard.html#length">length</a></li><li data-type='method'><a href="LEDBoard.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="LEDBoard.html#off">off</a></li><li data-type='method'><a href="LEDBoard.html#on">on</a></li><li data-type='method'><a href="LEDBoard.html#toggle">toggle</a></li><li data-type='method'><a href="LEDBoard.html#value">value</a></li></ul></li><li><a href="LEDCollection.html">LEDCollection</a><ul class='methods'><li data-type='method'><a href="LEDCollection.html#active_high">active_high</a></li><li data-type='method'><a href="LEDCollection.html#close">close</a></li><li data-type='method'><a href="LEDCollection.html#is_active">is_active</a></li><li data-type='method'><a href="LEDCollection.html#leds">leds</a></li><li data-type='method'><a href="LEDCollection.html#length">length</a></li><li data-type='method'><a href="LEDCollection.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="LEDCollection.html#off">off</a></li><li data-type='method'><a href="LEDCollection.html#on">on</a></li><li data-type='method'><a href="LEDCollection.html#toggle">toggle</a></li><li data-type='method'><a href="LEDCollection.html#value">value</a></li></ul></li><li><a href="MockPin.html">MockPin</a></li><li><a href="MockPulledUpPin.html">MockPulledUpPin</a></li><li><a href="Motor.html">Motor</a><ul class='methods'><li data-type='method'><a href="Motor.html#backward">backward</a></li><li data-type='method'><a href="Motor.html#close">close</a></li><li data-type='method'><a href="Motor.html#closed">closed</a></li><li data-type='method'><a href="Motor.html#forward">forward</a></li><li data-type='method'><a href="Motor.html#is_active">is_active</a></li><li data-type='method'><a href="Motor.html#length">length</a></li><li data-type='method'><a href="Motor.html#namedtuple">namedtuple</a></li><li data-type='method'><a href="Motor.html#reverse">reverse</a></li><li data-type='method'><a href="Motor.html#stop">stop</a></li><li data-type='method'><a href="Motor.html#value">value</a></li></ul></li><li><a href="OutputDevice.html">OutputDevice</a><ul class='methods'><li data-type='method'><a href="OutputDevice.html#active_high">active_high</a></li><li data-type='method'><a href="OutputDevice.html#close">close</a></li><li data-type='method'><a href="OutputDevice.html#closed">closed</a></li><li data-type='method'><a href="OutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="OutputDevice.html#off">off</a></li><li data-type='method'><a href="OutputDevice.html#on">on</a></li><li data-type='method'><a href="OutputDevice.html#pin">pin</a></li><li data-type='method'><a href="OutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="OutputDevice.html#toString">toString</a></li><li data-type='method'><a href="OutputDevice.html#value">value</a></li></ul></li><li><a href="PiBoardInfo.html">PiBoardInfo</a><ul class='methods'><li data-type='method'><a href="PiBoardInfo.html#physical_pin">physical_pin</a></li><li data-type='method'><a href="PiBoardInfo.html#physical_pins">physical_pins</a></li><li data-type='method'><a href="PiBoardInfo.html#pulled_up">pulled_up</a></li></ul></li><li><a href="PiGPIOPin.html">PiGPIOPin</a></li><li><a href="Pin.html">Pin</a></li><li><a href="PinError.html">PinError</a></li><li><a href="PinMutliplePins.html">PinMutliplePins</a></li><li><a href="PinNoPins.html">PinNoPins</a></li><li><a href="PinUnknownPi.html">PinUnknownPi</a></li><li><a href="PiTraffic.html">PiTraffic</a></li><li><a href="PWMLED.html">PWMLED</a><ul class='methods'><li data-type='method'><a href="PWMLED.html#blink">blink</a></li><li data-type='method'><a href="PWMLED.html#close">close</a></li><li data-type='method'><a href="PWMLED.html#frequency">frequency</a></li><li data-type='method'><a href="PWMLED.html#is_active">is_active</a></li><li data-type='method'><a href="PWMLED.html#is_lit">is_lit</a></li><li data-type='method'><a href="PWMLED.html#off">off</a></li><li data-type='method'><a href="PWMLED.html#on">on</a></li><li data-type='method'><a href="PWMLED.html#pulse">pulse</a></li><li data-type='method'><a href="PWMLED.html#toggle">toggle</a></li><li data-type='method'><a href="PWMLED.html#value">value</a></li></ul></li><li><a href="PWMOutputDevice.html">PWMOutputDevice</a><ul class='methods'><li data-type='method'><a href="PWMOutputDevice.html#blink">blink</a></li><li data-type='method'><a href="PWMOutputDevice.html#close">close</a></li><li data-type='method'><a href="PWMOutputDevice.html#frequency">frequency</a></li><li data-type='method'><a href="PWMOutputDevice.html#is_active">is_active</a></li><li data-type='method'><a href="PWMOutputDevice.html#off">off</a></li><li data-type='method'><a href="PWMOutputDevice.html#on">on</a></li><li data-type='method'><a href="PWMOutputDevice.html#pulse">pulse</a></li><li data-type='method'><a href="PWMOutputDevice.html#toggle">toggle</a></li><li data-type='method'><a href="PWMOutputDevice.html#value">value</a></li></ul></li><li><a href="RGBLED.html">RGBLED</a><ul class='methods'><li data-type='method'><a href="RGBLED.html#close">close</a></li><li data-type='method'><a href="RGBLED.html#is_active">is_active</a></li><li data-type='method'><a href="RGBLED.html#off">off</a></li><li data-type='method'><a href="RGBLED.html#on">on</a></li><li data-type='method'><a href="RGBLED.html#toggle">toggle</a></li><li data-type='method'><a href="RGBLED.html#value">value</a></li></ul></li><li><a href="TrafficLights.html">TrafficLights</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">pins/pigpio.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const pigpio = require('js-pigpio');
const p = require("./index.js");
const inherit = require('../tools.js').inherit;
const Pin = require("./index.js").Pin;

const _CONNECTIONS = []; // maps (host, port) to (connection, pi_info)
const _PINS = [];

/**
 *
 * Uses the library {@link https://www.npmjs.com/package/js-pigpio|js-pigpio} to interface to the Pi's GPIO pins. The pigpio library relies on a daemon {@link http://abyz.co.uk/rpi/pigpio/|pigpiod}  to be running as root to provide access to the GPIO pins, and communicates with this daemon over a network socket.
 *
 * While this does mean only the daemon itself should control the pins, the architecture does have several advantages:
 * * Pins can be remote controlled from another machine (the other machine doesn't even have to be a Raspberry Pi; it simply needs the `pigpio`_ client library installed on it),
 * * The daemon supports hardware PWM via the DMA controller.
 * * Your script itself doesn't require root privileges; it just needs to be able to communicate with the daemon.
 *
 * @example
 * from gpiozero.pins.pigpiod import PiGPIOPin
 * from gpiozero import LED
 * led = LED(PiGPIOPin(12))
 *
 * This is particularly useful for controlling pins on a remote machine. To
 * accomplish this simply specify the host (and optionally port) when
 * constructing the pin.
 *
 * @example
 * from gpiozero.pins.pigpiod import PiGPIOPin
 * from gpiozero import LED
 * from signal import pause
 * led = LED(PiGPIOPin(12, '192.168.0.2',5000)
 *
 * @param {number} number - GPIO Pin.
 * @param {string} [host] - IP address of remote server defaults to localhost.
 * @param {string} [port] - Port of remote server.
 * @returns {PiGPIOPin} - An instance of a PiGPIOPin.
 *
 * @class
 */
function PiGPIOPin (number, host, port) {
    if (host === undefined) {
        host = process.env.PIGPIO_ADDR || 'localhost';
    }
    if (port === undefined) {
        port =  process.env.PIGPIO_PORT || '8888';
    }
    const old_pin = _PINS[number+':'+host+':'+port];
    if (old_pin === undefined) {
        Pin.call(this);

        _PINS[number+':'+host+':'+port] = this;
        this._number = number;
        this._host = host;
        this._port = port;
        this._function = 'input';
        this._state = false;
        this._pull = 'floating';
        this._bounce = null;
        this._edges = 'both';
        this._when_changed = null;
        pi_info(host, port);
        return this;
    }
}

PiGPIOPin.prototype = inherit(p.Pin.prototype);
PiGPIOPin.prototype.constructor = PiGPIOPin;

exports.PiGPIOPin = PiGPIOPin;

function pi_info (host, port) {
    if (host === undefined) {
        host = process.env.PIGPIO_ADDR || 'localhost';
    }
    if (port === undefined) {
        port =  process.env.PIGPIO_PORT || '8888';
    }
    const _connection = _CONNECTIONS[host+':'+ port];

    if(_connection === undefined) {
        const connection = pigpio.pi(host, port);
        const revision = connection.get_hardware_revision();
        const info = pi_info(revision);
       _CONNECTIONS[host+':'+port] = {connection, info};
       return info;
    }
    return _connection.info;
}
 /*
class PiGPIOPin(Pin):
"""
GPIO_FUNCTIONS = {
    'input':   pigpio.INPUT,
    'output':  pigpio.OUTPUT,
    'alt0':    pigpio.ALT0,
    'alt1':    pigpio.ALT1,
    'alt2':    pigpio.ALT2,
    'alt3':    pigpio.ALT3,
    'alt4':    pigpio.ALT4,
    'alt5':    pigpio.ALT5,
}

GPIO_PULL_UPS = {
    'up':       pigpio.PUD_UP,
    'down':     pigpio.PUD_DOWN,
    'floating': pigpio.PUD_OFF,
}

GPIO_EDGES = {
    'both':    pigpio.EITHER_EDGE,
    'rising':  pigpio.RISING_EDGE,
    'falling': pigpio.FALLING_EDGE,
}

GPIO_FUNCTION_NAMES = {v: k for (k, v) in GPIO_FUNCTIONS.items()}
GPIO_PULL_UP_NAMES = {v: k for (k, v) in GPIO_PULL_UPS.items()}
GPIO_EDGES_NAMES = {v: k for (k, v) in GPIO_EDGES.items()}

def __new__(
    cls, number, host=os.getenv('PIGPIO_ADDR', 'localhost'),
    port=int(os.getenv('PIGPIO_PORT', 8888))):
try:
return cls._PINS[(host, port, number)]
except KeyError:
    self = super(PiGPIOPin, cls).__new__(cls)
cls.pi_info(host, port) # implicitly creates connection
self._connection, self._pi_info = cls._CONNECTIONS[(host, port)]
try:
self._pi_info.physical_pin('GPIO%d' % number)
except PinNoPins:
    warnings.warn(
        PinNonPhysical(
            'no physical pins exist for GPIO%d' % number))
self._host = host
self._port = port
self._number = number
self._pull = 'up' if self._pi_info.pulled_up('GPIO%d' % number) else 'floating'
self._pwm = False
self._bounce = None
self._when_changed = None
self._callback = None
self._edges = pigpio.EITHER_EDGE
try:
self._connection.set_mode(self._number, pigpio.INPUT)
except pigpio.error as e:
raise ValueError(e)
self._connection.set_pull_up_down(self._number, self.GPIO_PULL_UPS[self._pull])
self._connection.set_glitch_filter(self._number, 0)
cls._PINS[(host, port, number)] = self
return self

def __repr__(self):
if self._host == 'localhost':
return "GPIO%d" % self._number
else:
return "GPIO%d on %s:%d" % (self._number, self._host, self._port)

@property
def host(self):
return self._host

@property
def port(self):
return self._port

@property
def number(self):
return self._number

def close(self):
# If we're shutting down, the connection may have disconnected itself
# already. Unfortunately, the connection's "connected" property is
# rather buggy - disconnecting doesn't set it to False! So we're
# naughty and check an internal variable instead...
if self._connection.sl.s is not None:
    self.frequency = None
self.when_changed = None
self.function = 'input'
self.pull = 'up' if self._pi_info.pulled_up('GPIO%d' % self.number) else 'floating'

def _get_function(self):
return self.GPIO_FUNCTION_NAMES[self._connection.get_mode(self._number)]

def _set_function(self, value):
if value != 'input':
self._pull = 'floating'
try:
self._connection.set_mode(self._number, self.GPIO_FUNCTIONS[value])
except KeyError:
    raise PinInvalidFunction('invalid function "%s" for pin %r' % (value, self))

def _get_state(self):
if self._pwm:
return (
    self._connection.get_PWM_dutycycle(self._number) /
    self._connection.get_PWM_range(self._number)
)
else:
return bool(self._connection.read(self._number))

def _set_state(self, value):
if self._pwm:
try:
value = int(value * self._connection.get_PWM_range(self._number))
if value != self._connection.get_PWM_dutycycle(self._number):
self._connection.set_PWM_dutycycle(self._number, value)
except pigpio.error:
raise PinInvalidState('invalid state "%s" for pin %r' % (value, self))
elif self.function == 'input':
raise PinSetInput('cannot set state of pin %r' % self)
else:
# write forces pin to OUTPUT, hence the check above
self._connection.write(self._number, bool(value))

def _get_pull(self):
return self._pull

def _set_pull(self, value):
if self.function != 'input':
raise PinFixedPull('cannot set pull on non-input pin %r' % self)
if value != 'up' and self._pi_info.pulled_up('GPIO%d' % self._number):
raise PinFixedPull('%r has a physical pull-up resistor' % self)
try:
self._connection.set_pull_up_down(self._number, self.GPIO_PULL_UPS[value])
self._pull = value
except KeyError:
    raise PinInvalidPull('invalid pull "%s" for pin %r' % (value, self))

def _get_frequency(self):
if self._pwm:
return self._connection.get_PWM_frequency(self._number)
return None

def _set_frequency(self, value):
if not self._pwm and value is not None:
    self._connection.set_PWM_frequency(self._number, value)
self._connection.set_PWM_range(self._number, 10000)
self._connection.set_PWM_dutycycle(self._number, 0)
self._pwm = True
elif self._pwm and value is not None:
    if value != self._connection.get_PWM_frequency(self._number):
self._connection.set_PWM_frequency(self._number, value)
self._connection.set_PWM_range(self._number, 10000)
elif self._pwm and value is None:
    self._connection.write(self._number, 0)
self._pwm = False

def _get_bounce(self):
return None if not self._bounce else self._bounce / 1000000

def _set_bounce(self, value):
if value is None:
    value = 0
elif value &lt; 0:
raise PinInvalidBounce('bounce must be 0 or greater')
self._connection.set_glitch_filter(self._number, int(value * 1000000))

def _get_edges(self):
return self.GPIO_EDGES_NAMES[self._edges]

def _set_edges(self, value):
f = self.when_changed
self.when_changed = None
try:
self._edges = self.GPIO_EDGES[value]
finally:
self.when_changed = f

def _get_when_changed(self):
if self._callback is None:
    return None
return self._callback.callb.func

def _set_when_changed(self, value):
if self._callback is not None:
    self._callback.cancel()
self._callback = None
if value is not None:
    self._callback = self._connection.callback(
        self._number, self._edges,
        lambda gpio, level, tick: value())

@classmethod
def pi_info(
    cls, host=os.getenv('PIGPIO_ADDR', 'localhost'),
    port=int(os.getenv('PIGPIO_PORT', 8888))):
try:
connection, info = cls._CONNECTIONS[(host, port)]
except KeyError:
    connection = pigpio.pi(host, port)
revision = '%04x' % connection.get_hardware_revision()
info = pi_info(revision)
cls._CONNECTIONS[(host, port)] = (connection, info)
return info

*/</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Jan 10 2017 21:18:23 GMT+0000 (GMT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
